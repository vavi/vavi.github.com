---
layout: post
title: "computer architecture introduction"
description: ""
category: 
tags: []
---

## 计算机体系结构概述

 
NUMA SMP
 
overhead 
顺序存储： 
随机存储：
对汇编指令的学习，属于生态系统和职责分工。 编译原理，cpu，操作系统， 但是由于遗忘特性

输入，计算，输出

AUPE

内核 vs 库函数   sbrk vs malloc
creat 是 open 的简便函数，封装了open
lseek 没有发生实际的io操作
进程终止时，内核会自动释放句柄
read ahead 、write behind  P71
sync 加入写队列缓存就返回，fsync 写入到磁盘后才返回
为了打开文件，需要具有文件所在目录的执行权限
void *

I/O多路复用（I/O multiplexing）首先构造一张有关描述符的列表，然后调用一个函数，直到这些描述符中的一个已经准备I/O时，该函数才返回。在返回时，它告诉进程哪些描述符已经准备好可以进行I/O

poll、pselect和select这3个函数使我们能够执行I/O多路复用。

p581 

单机 
多机
网络拓扑
协议定义
协议实现
google CLOS

---

网络编程

电话类比网络连接关系原来在UP中已经阐述。

TIME_WAIT 允许最大跳数内的并且小于2MSL的数据包重传

P36 3次握手状态

P78

p85  baklog 图

listen 指定 backlog。内核维护两个队列 未完成连接队列（处于SYN_RCVD状态），已完成连接队列

毒药 和哨兵 dummy

syn flood 攻击  忽略了大量关于c语言之间的描述

accept 监听套接字 和  已连接套接字  前者一直存在  后者用完则关闭

p92

p122 必读 nio

select 的最大描述符设置需要重新编译或者使用新版本的的参数设置；线性搜索，扩展能力差。
选择 epoll

select 可读，可写，异常
无限等待，等待某段时间，不等待

p361 解释了 为什么需要finishConnect

僵尸进程，处理signal 。sigal handler

NUMA 可以快速访问本地内存，访问远程内存速度较慢。 

ssd 多路复用

一步步解释为什么操作系统会这么复杂
基本的输入，输出模型
性价比 
为了提升性能而做的各种tradeoff
引入一种模型后，然后又存在哪些问题
虚拟内存，tlb，cpu，磁盘

多路复用


一步步解释为什么操作系统会这么复杂
基本的输入，输出模型
性价比 
为了提升性能而做的各种tradeoff
引入一种模型后，然后又存在哪些问题
虚拟内存，tlb，cpu，磁盘


dubbo 怎么使用Javaassist的


AtomicIntegerFieldUpdater

infoq 2个人 文章复习 我的blog文章复习
网易那篇多线程复习 

通用设计，领域设计

整体浏览我的日志 

CSAPP 

补码是非对称编码
补码计算 

P43 介绍 反码和原码
 
抓住主要矛盾

性价比原理 寄存器 缓存  内存 磁盘
局部性原理（时间局部性 和空间局部性）：在具备良好时间局部性的程序中，被引用一次的存储器位置很可能在不远的将来会被再次引用。在具备良好空间局部性的程序中，被引用一次的存储器位置的附近位置很可能在不远的将来会被再次引用。

 cach miss （矩阵计算，二维数组本质上是一维数组，双重循环），false sharing
并发性原理 取指(内存到寄存器) 译码（） 计算  访存  写回  更新pc  流水线  乱序执行  分支预测(排序执行)
虚拟内存原理 ：更多进程需要更多内存，高效管理内存。 
tlb  方便管理内存，避免重复IO 虚拟内存 支持
	 内存容量不够 swap机制
扫一扫+工具检测 
降低循环内的低效计算
数组和链表的区别
并发锁的粒度和策略

cpu --存储控制器  -- 内存 -- 先将行数据复制到内存的内部缓冲区内，然后再根据列去取数据

地址，数据 内存 

锁的本质内部实现？总线锁定？行锁


旋转磁盘和固态硬盘

磁盘 ：512字节 300扇区 20000磁道  2盘面 5盘片 

寻道时间 旋转时间 传送时间 前2者耗时较大，访问第一个自己耗费很长时间，后面几乎不耗费时间。所以操作系统会预读。。

逻辑磁盘块：现代磁盘构造复杂，为了对os隐藏这些复杂性，现代磁盘提供了一个简单的视图，称为逻辑块。磁盘控制器维护着逻辑块和实际物理的磁盘扇区之间的映射关系。os执行i/o操作时，通过制定逻辑块号，磁盘控制器的固件执行一个快速查找，将逻辑号翻译成（盘面，磁道，删除）的3元组，这个3元组唯一标识了对应的物理扇区。控制器的硬件解释这个3元组，将读、写头移动到适当的柱面，等待扇区移动到读写头下，将读写头感知的位放到控制器里面的一个小缓冲区内，然后复制到内存中。


虽然xxx详细描述超出了我们的讨论反问，但是我们可以概要描述下。


存储器映射I/O: cpu使用这种技术来想i/o设备发送命令。首先在唉地址空间中。有一块地址是为与I/O设备通信保留的。每个这样的地址称为一个I/O port。当一个I/O设备连接到总线时，它与一个或多个端口相关联。

cpu可能通过执行3个对 I/O port （比如为0Xa0）的存储指令。当磁盘控制器收到cpu读命令后，它将逻辑块翻译成扇区地址 ，然后将内容直接传送到主存，不需要cpu的干涉。这种过程称为DMA。

TLB MMU

6。4章节 P409那个t翻译错误，应该是标记位。

图，文不在一页真的很烦。

direct mapped cache  将内存地址分为3部分  标记位  组索引 和 偏移量，偏移量表示从什么地方开始取数据。

内存分页 和 cache 分页相对应。

虚拟存储器是一个数组，一个存放在磁盘上的N个连续的字节大小的单元组成的数组。
分为 未分配 ，未缓存，已缓存，
   未分配  不占用内存和磁盘空间
   未缓存  不占用内存，占用磁盘
   已缓存  占用内存和磁盘
虚拟存储器分为多个页面，每个页面称为虚拟页，是一个大小固定的块。

页表（在内存中） 数据结构，存放了虚拟页到物理页的映射关系（读写目标）
操作系统 负责维护页表的内容，以及在磁盘和内存中传送页。（写）
MMU（硬件），地址翻译硬件，负责在将虚拟内存转换成物理内存时读取页表。（读）    
     高速缓存、内存
发生缺页中断后，会把被牺牲的脏页写回以及交换页面。

TLB是MMU硬件内部的一个小缓存，用来加速翻译。



根据http://www.hardtoc.com/archives/119 引用的标准， -2147483648 是一个常量表达式，首先是获取2147483648 ，然后计算-这个符号。但是在获取时2147483648，已经发生溢出。会变成一个 unsigned long int 或者long long int. 

http://www.cnblogs.com/baiweiguo/archive/2013/01/15/2861286.html
http://blog.sweelia.com/articles/2013/01/05/1357370792163.html

深入分析javaweb技术内部的 tomcat（how tomcat works），spring，ibatis



### 重要细节
同一个数据中心延时较小，网络一次来回的时间在1毫秒之内。北京，杭州距离1300km，光在信息传输时走折线，假设折现距离是直线距离的1.5倍，那么整个耗时 1300*1.5*2/300000=13毫秒，实测时40毫秒。 

分布式存储系统 p10 性能参数 
{% include JB/setup %}
